#!/usr/bin/env bash

# Syntax sugar.
source $BIN_DIR/utils
puts-step "Configuring SWIG"

# Setup Conf Variables
SWIG_VERSION=2.0.5 # The swig version we are supporting
SWIG_SRC=.swig_${SWIG_VERSION} # The name of the directory this will live in
S3_BUCKET=p22-heroku-buildpacks/libraries 
SWIG_SOURCE_URL=https://s3.amazonaws.com/${S3_BUCKET}/swig.${SWIG_VERSION}.tar.gz
CACHED_SWIG=$CACHE_DIR/$SWIG_SRC


if [ ! -d $CACHED_SWIG ]; then
    cd $BUILD_DIR
    echo "** SWIG not found in cache - installing" | indent
    puts-step "Fetching and installing SWIG 2 from $SWIG_SOURCE_URL"
    mkdir -p $CACHED_SWIG
    curl $SWIG_SOURCE_URL | tar zxv -C $CACHED_SWIG &> /dev/null
    if [ ! -d $CACHED_SWIG ]; then
      puts-warn "WARNING: SWIG not downloaded or installed properly"
      exit 1
    else
      echo "SWIG $SWIG_VERSION installed" | indent
    fi
else
    echo "SWIG $SWIG_VERSION detected in the cache" | indent
fi

puts-step "Making $SWIG_SRC folder and copying source from $CACHED_SWIG"
mkdir -p $SWIG_SRC
cp -R $CACHED_SWIG/ $SWIG_SRC
echo "Updating path...." | indent
PATH=$PATH:$BUILD_DIR/$SWIG_SRC/swig/bin
export PATH
echo "Path: $PATH" | indent
echo "Setting SWIG_LIB" | indent
export SWIG_LIB=$BUILD_DIR/$SWIG_SRC/swig/share/swig/2.0.5/
echo "SWIG_LIB: $SWIG_LIB" | indent
puts-step "SWIG completed"
